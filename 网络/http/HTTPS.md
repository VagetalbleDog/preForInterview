# https概述
https主要是通过在http层和tcp层中加入了SSL/TLS协议，可以实现：
  - 信息加密
  - 校验机制：无法篡改通信内容
  - 身份证书
  
# 什么是非对称加密算法？

共有两个密钥：

  - 一个是公钥，这个是可以公开给所有人的；
  - 一个是私钥，这个必须由本人管理，不可泄露。
  
这两个密钥可以双向加解密的，比如可以用公钥加密内容，然后用私钥解密，也可以用私钥加密内容，公钥解密内容。

流程的不同，意味着目的也不相同：

  - 公钥加密，私钥解密。这个目的是为了保证内容传输的安全，因为被公钥加密的内容，其他人是无法解密的，只有持有私钥的人，才能解密出实际的内容
  
  - 私钥加密，公钥解密。这个目的是为了保证消息不会被冒充，因为私钥是不可泄露的，如果公钥能正常解密出私钥加密的内容，就能证明这个消息是来源于持有私钥身份的人发送的。
  
# https 如何解决上面的三个风险？

## 混合加密（来保障信息加密传输）

  https采用对称加密和非对称加密的混合加密方式

  - 在通信建立前采用非对称加密的方式交换密钥，后续就不再使用非对称加密
  
  - 通信过程中，全部使用对称加密的会话密钥加密明文数据

## 摘要算法➕ 数字签名（来保障信息校验机制）

  - 摘要算法：
  
    数据发送前，需要使用**摘要算法（实际上是一个哈希函数）**来计算出内容的哈希值，作为摘要，和内容一起发送给对方。对方收到后，会使用同样的摘要算法，对收到的内容计算出摘要，如果摘要一致证明内容没有被篡改。
  
  - 数字签名：
    
    上述的过程可以保证内容不会被篡改，**但是仍有可能【内容+哈希值】**会一起被中间人替换掉，所以这里还缺少一份客户端收到的数据包是否来源于服务端的证明

    非对称加密的用途主要在于通过「私钥加密，公钥解密」的方式，来确认消息的身份，我们常说的数字签名算法，就是用的是这种方式，不过私钥加密内容不是内容本身，而是对内容的哈希值加密

## 数字证书（保证身份不会被伪造）

  由权威机构（CA）颁发，通过数字证书可以保证服务器公钥不会被伪造。

# https 如何建立连接？

SSL/TLS的建立过程，也就是TLS握手阶段，涉及四次通信，一下介绍基于RSA握手的HTTPS

  1. ClientHello 
   
     客户端向服务器发起加密通信请求，并向服务器发送以下信息：

       - 客户端支持的SSL/TLS版本，如TLS 1.2
       - 客户端生成的一个随机数，用于生成【会话密钥】
       - 客户端支持的密码套件列表，一般是RSA加密算法
  
  2. ServerHello
   
     服务器收到客户端的请求之后，回应客户端，发送以下信息：

       - 确认客户端的SSL/TLS版本，TLS 1.2
       - 确认客户端的密码套件列表，RSA加密算法
       - 服务端生成的一个随机数，用于生成【绘画密钥】
       - 服务端的数字证书（客户端拿到后会进行验证）

  3. 客户端回应
   
     首先，通过操作系统或浏览器中的CA公钥，验证服务端发来的数字证书是否合法

     如果合法，客户端从服务器发来的数字证书中，取出服务器的公钥，使用公钥加密报文，向服务器发送以下信息：

       - 一个随机数（会被公钥加密）
       - 加密算法改变同志，表示后续的信息都将用【会话密钥】加密通信。
       - 客户端握手结束通知
    
     此时客户端、服务器已经有三个随机数了，可以使用双方协商的加密算法（RSA加密算法）进行加密，各自生成这次通信的会话密钥。

  4. 服务器最后回应

     服务器收到客户端的第三个随机数，生成【会话密钥】

     然后向客户端发送以下信息：

       - 加密算法改变通知，代表后续的信息全部用【会话密钥】加密
       - 服务器握手结束通知

接下来，就是完全普通的http协议，只不过会用【会话密钥】加密内容